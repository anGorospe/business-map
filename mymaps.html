<!DOCTYPE html>
<html>
  <head>
    <title>Business Map (Google Sheets)</title>
    <meta charset="utf-8" />
    <style>
      #map {
        height: 100vh;
        width: 100%;
      }
      .info-window {
        font-family: Arial, sans-serif;
        font-size: 14px;
      }
      .info-window h3 {
        margin: 0;
        font-size: 16px;
      }
      .info-window p {
        margin: 4px 0;
      }
    </style>

    <!-- Load Google Maps -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdMrHW4487TYOWq2Eyf0QH7Yzlwkc7d68"
      defer
    ></script>

    <!-- Load Google Sheets Visualization API -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script>
      // ðŸ‘‡ Replace with your Google Sheet ID
      const sheetID = "2PACX-1vS1z-HCCdmir7r4SJmM4gueN1fWMqq2Fu8Q98l7w47u0eibjZTJiaVMhvdkoo7SX11Bd1y3cU635WIf";
      const sheetName = "Sheet1"; // Change if your tab is named differently
      const query = encodeURIComponent("SELECT A,B,C,D,E");
      const sheetUrl = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?sheet=${sheetName}&tq=${query}`;

      function fetchBusinesses(callback) {
        google.charts.load("current", { packages: ["corechart"] });
        google.charts.setOnLoadCallback(() => {
          const query = new google.visualization.Query(sheetUrl);
          query.send((response) => {
            if (response.isError()) {
              console.error("Error fetching data: " + response.getMessage());
              return;
            }
            const data = response.getDataTable();
            const businesses = [];
            for (let i = 0; i < data.getNumberOfRows(); i++) {
              businesses.push({
                name: data.getValue(i, 0),
                lat: parseFloat(data.getValue(i, 1)),
                lng: parseFloat(data.getValue(i, 2)),
                hours: data.getValue(i, 3),
                description: data.getValue(i, 4),
              });
            }
            callback(businesses);
          });
        });
      }

      function initMap() {
        fetchBusinesses((businesses) => {
          const map = new google.maps.Map(document.getElementById("map"), {
            zoom: 14,
            center: { lat: businesses[0].lat, lng: businesses[0].lng },
          });

          const infoWindow = new google.maps.InfoWindow();

          businesses.forEach((biz) => {
            const marker = new google.maps.Marker({
              position: { lat: biz.lat, lng: biz.lng },
              map: map,
              title: biz.name,
            });

            const content = `
              <div class="info-window">
                <h3>${biz.name}</h3>
                <p><strong>Hours:</strong> ${biz.hours}</p>
                <p>${biz.description}</p>
              </div>
            `;

            marker.addListener("click", () => {
              infoWindow.setContent(content);
              infoWindow.open(map, marker);
            });
          });
        });
      }

      window.initMap = initMap;
    </script>
  </head>
  <body onload="initMap()">
    <div id="map"></div>
  </body>
</html>
