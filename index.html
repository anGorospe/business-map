<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Business Map</title>
  <style>
    #map { height: 100vh; width: 100%; }
    .info-window { font-family: Arial, sans-serif; font-size: 14px; }
    .info-window h3 { margin: 0; font-size: 16px; }
    .info-window p { margin: 4px 0; }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Google Maps API -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAdMrHW4487TYOWq2Eyf0QH7Yzlwkc7d68&callback=initMap" async defer></script>

  <script>
    // ======= Google Sheets API Settings =======
    const SHEET_ID = "2PACX-1vQDzM3Nu-ROuwXQqfAamzS8iG2qTOEYTR8-uh2X0XeWUtlcAJ-G9bkqACZWgZTFJW3zlwKOfxeNYzoi";
    const RANGE = "Sheet1!A:E"; // adjust your sheet tab name/range
    const API_KEY = "AIzaSyAdMrHW4487TYOWq2Eyf0QH7Yzlwkc7d68";

    let map;

    async function initMap() {
      // Create the map
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 14,
        center: { lat: 37.7749, lng: -122.4194 } // default center
      });

      // Fetch sheet data
      const businesses = await fetchSheetData();

      if (!businesses.length) return;

      // Center map on first business
      const first = businesses[0];
      map.setCenter({ lat: parseFloat(first.Lat), lng: parseFloat(first.Lng) });

      // Add markers
      const infoWindow = new google.maps.InfoWindow();

      businesses.forEach(biz => {
        const lat = parseFloat(biz.Lat);
        const lng = parseFloat(biz.Lng);
        if (!lat || !lng) return;

        const marker = new google.maps.Marker({
          position: { lat, lng },
          map: map,
          title: biz.Name
        });

        const content = `
          <div class="info-window">
            <h3>${biz.Name}</h3>
            <p><strong>Hours:</strong> ${biz.Hours}</p>
            <p>${biz.Description}</p>
          </div>
        `;

        marker.addListener("click", () => infoWindow.setContent(content) || infoWindow.open(map, marker));
      });
    }

    async function fetchSheetData() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;
      try {
        const response = await fetch(url);
        if (!response.ok) {
          console.error("Error fetching sheet:", response.status, response.statusText);
          return [];
        }
        const data = await response.json();
        const rows = data.values;
        if (!rows || rows.length < 2) return [];

        const headers = rows[0];
        return rows.slice(1).map(row => {
          const obj = {};
          headers.forEach((h, i) => obj[h] = row[i] || "");
          return obj;
        });
      } catch (err) {
        console.error("Error fetching sheet:", err);
        return [];
      }
    }
  </script>
</body>
</html>
